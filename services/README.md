# Микросервисная архитектура для Telegram Mini App Audio Recorder

Этот каталог содержит микросервисную архитектуру для приложения Telegram Mini App Audio Recorder.

## Структура микросервисов

Система состоит из следующих микросервисов:

1. **telegram-mini-app** - Интерфейс пользователя для записи аудио в Telegram
2. **admin-service** - Административный интерфейс для управления записями
3. **api-service** - API сервис для взаимодействия с клиентами
4. **audio-processor** - Сервис обработки аудио (комбинирование фрагментов, транскрипция)
5. **documentation-service** - Сервис для предоставления документации
6. **data-storage** - Сервис для хранения данных
7. **monitoring** - Сервис мониторинга и оповещения

## Запуск микросервисов

### Запуск всех сервисов

```bash
./start-all.sh
```

### Остановка всех сервисов

```bash
./stop-all.sh
```

## Сервис мониторинга

Сервис мониторинга отслеживает состояние всех микросервисов и отправляет уведомления в Telegram при возникновении проблем.

### Функции сервиса мониторинга:

1. Проверка доступности всех микросервисов
2. Отправка ежеминутных отчетов о состоянии в Telegram
3. Отправка уведомлений при возникновении проблем
4. Отслеживание времени простоя сервисов
5. Анализ логов и выявление ошибок
6. Веб-интерфейс для просмотра статуса системы

### Запуск/остановка сервиса мониторинга

```bash
cd monitoring
./start-monitoring.sh
./stop-monitoring.sh
```

### Просмотр логов мониторинга

```bash
cd monitoring
./view-logs.sh         # Обычный просмотр
./view-logs.sh -f      # Просмотр в режиме следования (follow)
./view-logs.sh -e      # Просмотр только ошибок
```

## Конфигурация Telegram

Для работы уведомлений Telegram необходимо настроить переменные окружения в файле `monitoring/.env`:

```
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

Получить эти значения можно следующим образом:
1. Создайте бота через @BotFather и получите токен
2. Добавьте бота в чат/группу
3. Запустите скрипт `get_telegram_group_id.js` для получения chat_id

## Структура каталогов

```
services/
├── telegram-mini-app/       # Интерфейс в Telegram
├── admin-service/           # Административный интерфейс 
├── api-service/             # API сервис
├── audio-processor/         # Сервис обработки аудио
├── documentation-service/   # Сервис документации
├── data-storage/            # Сервис хранения данных
├── monitoring/              # Сервис мониторинга
│   ├── src/                 # Исходный код сервиса
│   ├── utils/               # Утилиты и вспомогательные модули
│   ├── public/              # Статические файлы для веб-интерфейса
│   ├── logs/                # Логи сервиса
│   ├── start-monitoring.sh  # Скрипт запуска мониторинга
│   ├── stop-monitoring.sh   # Скрипт остановки мониторинга
│   ├── view-logs.sh         # Скрипт просмотра логов
│   └── .env                 # Файл с переменными окружения
├── start-all.sh             # Скрипт запуска всех сервисов
└── stop-all.sh              # Скрипт остановки всех сервисов
```