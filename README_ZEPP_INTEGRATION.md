# Интеграция с Zepp OS

В данном проекте реализована интеграция с умными часами, работающими на Zepp OS. Это позволяет записывать аудио непосредственно с умных часов и отправлять записи на сервер для дальнейшей обработки.

## Содержание пакета для Zepp OS

1. **Исходный код приложения для Zepp OS** (директория `zepp_app/`)
2. **Готовый пакет для установки на часы** (`zepp_app_bundle.zip`)
3. **Инструкция по публикации приложения** (`zepp_deploy_instructions.md`)
4. **Инструкция по настройке серверной части** (`server_config.md`)
5. **Тестовый скрипт для проверки интеграции** (`test-zepp-integration.js`)

## Как установить и использовать

### Шаг 1: Настройка сервера

Убедитесь, что сервер корректно настроен для приема данных от Zepp OS:
- API эндпоинты настроены в соответствии с `server_config.md`
- Сервер доступен по HTTPS
- CORS настроен для разрешения запросов от Zepp OS

### Шаг 2: Упаковка и установка приложения

Для установки на часы:
1. Переименуйте `zepp_app_bundle.zip` в `zepp_app_bundle.zab`
2. Следуйте инструкциям из `zepp_deploy_instructions.md` для установки на часы или публикации в магазине

### Шаг 3: Тестирование интеграции

Для проверки работы интеграции запустите тестовый скрипт:
```bash
node test-zepp-integration.js
```

## Ключевые возможности

Приложение Zepp OS предоставляет следующую функциональность:

1. **Запись аудио** - использование микрофона часов для записи аудио
2. **Фрагментирование** - разделение длинных записей на фрагменты для более эффективной передачи данных
3. **Повторные попытки** - встроенный механизм восстановления после сбоев сети
4. **Offline запись** - запись продолжается даже при временных сбоях в подключении к сети

## Технические детали

### API эндпоинты

Приложение Zepp OS взаимодействует с сервером через следующие API:

- `POST /api/zepp/recording-fragments` - отправка фрагментов аудио
- `POST /api/zepp/finalize-recording` - финализация записи после отправки всех фрагментов

### Формат данных

- Аудио записывается в формате WebM (Opus) с моно каналом
- Максимальный размер фрагмента: ~1MB
- Идентификатор сессии и индекс фрагмента используются для корректного объединения частей записи

## Типичный сценарий использования

1. Пользователь запускает приложение на часах
2. Начинает запись аудио
3. Часы разбивают запись на фрагменты и отправляют их на сервер
4. После завершения записи, часы отправляют запрос на финализацию
5. Сервер объединяет фрагменты, конвертирует аудио и создает запись в базе данных
6. Запись становится доступна в веб-интерфейсе админки

## Совместимость

Приложение совместимо со следующими устройствами:
- Amazfit GTR 3 Pro
- Другие устройства с Zepp OS 3.0 и выше

## Обновление конфигурации

Для обновления URL сервера в приложении, отредактируйте файл `zepp_app/utils/api.js` и обновите константу `SERVER_URL`.