# Сервис мониторинга для Telegram Mini App

Сервис мониторинга отслеживает состояние всех микросервисов и отправляет уведомления в Telegram при возникновении проблем.

## Возможности

- ✅ Мониторинг доступности всех микросервисов
- ✅ Отправка ежеминутных отчетов о состоянии в Telegram
- ✅ Отслеживание времени отклика и простоя сервисов
- ✅ Анализ логов и выявление ошибок
- ✅ Веб-интерфейс для просмотра статуса системы
- ✅ Запись истории изменений состояния сервисов
- ✅ Оповещения о критических ошибках и восстановлении сервисов

## Требования

- Node.js 18+
- npm или yarn
- Токен бота Telegram
- ID чата Telegram для отправки уведомлений

## Установка

1. Клонируйте репозиторий
2. Установите зависимости
   ```
   cd monitoring
   npm install
   ```
3. Создайте файл `.env` и заполните его:
   ```
   # Настройки Telegram бота для мониторинга
   TELEGRAM_BOT_TOKEN=your_bot_token
   TELEGRAM_CHAT_ID=your_chat_id

   # Порт для веб-интерфейса мониторинга
   PORT=3200

   # Интервал проверки здоровья (в миллисекундах)
   HEALTH_CHECK_INTERVAL=60000

   # Путь для хранения логов
   LOG_PATH=./logs

   # Настройки сервисов для мониторинга (разделенные запятыми)
   SERVICES=telegram-mini-app,admin-service,api-service,audio-processor,documentation-service,data-storage

   # URL для проверки здоровья сервисов
   SERVICE_URLS=http://localhost:3100/health,http://localhost:3101/health,http://localhost:3102/health,http://localhost:3103/health,http://localhost:3104/health,http://localhost:3105/health
   ```

## Запуск

```bash
./start-monitoring.sh
```

## Остановка

```bash
./stop-monitoring.sh
```

## Просмотр логов

```bash
./view-logs.sh         # Обычный просмотр
./view-logs.sh -f      # Просмотр в режиме следования (follow)
./view-logs.sh -e      # Просмотр только ошибок
```

## Использование веб-интерфейса

Веб-интерфейс доступен по адресу http://localhost:3200

### Основные функции веб-интерфейса:

1. Просмотр текущего статуса всех сервисов
2. Просмотр истории изменений статусов
3. Просмотр последних ошибок из логов
4. Обновление информации в реальном времени

## Конфигурация Telegram

Для работы уведомлений Telegram необходимо:

1. Создать бота через @BotFather и получить токен
2. Добавить бота в чат/группу
3. Запустить скрипт `get_telegram_group_id.js` для получения chat_id

```bash
node ../get_telegram_group_id.js
```

## Структура файлов

```
monitoring/
├── src/                 # Исходный код сервиса
│   └── index.js         # Основной файл сервиса
├── utils/               # Утилиты и вспомогательные модули
│   ├── health-check.js  # Модуль проверки здоровья сервисов
│   ├── logger.js        # Модуль логирования
│   ├── telegram.js      # Модуль отправки уведомлений в Telegram
│   └── log-analyzer.js  # Модуль анализа логов
├── public/              # Статические файлы для веб-интерфейса
│   └── index.html       # Веб-интерфейс
├── logs/                # Директория для хранения логов
├── start-monitoring.sh  # Скрипт запуска мониторинга
├── stop-monitoring.sh   # Скрипт остановки мониторинга
├── view-logs.sh         # Скрипт просмотра логов
├── package.json         # Файл с зависимостями
└── .env                 # Файл с переменными окружения
```