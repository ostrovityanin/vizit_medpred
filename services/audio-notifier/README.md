# Микросервис Audio Notifier

Микросервис для автоматической отправки аудиозаписей и их расшифровок в Telegram группу.

## Описание

Данный микросервис периодически проверяет наличие новых аудиозаписей на сервере API, которые еще не были отправлены в Telegram, и отправляет их вместе с транскрипцией (расшифровкой) в указанный чат Telegram.

## Функциональность

- Периодическая проверка новых завершенных записей через API
- Скачивание аудиофайлов записей
- Отправка аудиофайлов в Telegram группу
- Отправка транскрипций аудиозаписей
- Отслеживание отправленных записей для избежания дублирования
- Логирование всех операций

## Требования

- Node.js (версия 14+)
- Токен Telegram бота
- ID чата Telegram для отправки сообщений
- Доступ к API сервера записей

## Настройка

1. Создайте файл `.env` в корневой директории микросервиса (или используйте существующий):

```
# Конфигурация микросервиса audio-notifier

# Параметры Telegram Bot
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_CHAT_ID=ид_чата_или_группы

# URL сервера API
API_URL=http://localhost:5000

# Интервал проверки новых записей (в миллисекундах)
CHECK_INTERVAL=60000

# Уровень логирования (debug, info, warn, error)
LOG_LEVEL=info
```

2. Установите зависимости:

```bash
npm install
```

## Запуск

Для запуска микросервиса используйте скрипт `start.sh`:

```bash
./start.sh
```

## Остановка

Для остановки микросервиса используйте скрипт `stop.sh`:

```bash
./stop.sh
```

## Структура логов

Логи сохраняются в директории `logs`:

- `audio-notifier.log` - все логи
- `audio-notifier-error.log` - только ошибки
- `audio-notifier-console.log` - вывод консоли (stdout/stderr)

## Интеграция с основным сервером

Микросервис взаимодействует с основным сервером через API:

- `/api/admin/recordings` - получение списка всех записей
- `/api/admin/recordings/:id` - получение детальной информации о записи
- `/api/recordings/:id/download` - скачивание аудиофайла записи
- `/api/admin/recordings/:id/mark-sent` - отметка о том, что запись была отправлена

## Автозапуск при старте системы

Микросервис может быть настроен для автоматического запуска при старте системы, используя systemd или аналогичные менеджеры процессов.

## Разработчики

Replit Studio / Audio Recording App Team