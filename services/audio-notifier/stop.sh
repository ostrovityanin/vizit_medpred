#!/bin/bash

# Скрипт для остановки микросервиса audio-notifier
echo "Остановка микросервиса отправки аудио в Telegram..."

# Переходим в директорию микросервиса
cd "$(dirname "$0")"

# Проверяем, существует ли файл с PID
if [ ! -f ".pid" ]; then
    echo "Микросервис не запущен или PID файл не найден"
    exit 0
fi

# Читаем PID из файла
PID=$(cat ".pid")

# Проверяем, существует ли процесс с этим PID
if ! ps -p $PID > /dev/null; then
    echo "Процесс с PID $PID не найден"
    rm -f ".pid"
    exit 0
fi

# Останавливаем процесс
echo "Остановка процесса с PID: $PID..."
kill $PID

# Проверяем, успешно ли остановлен процесс
sleep 2
if ps -p $PID > /dev/null; then
    echo "Процесс не остановлен, принудительное завершение..."
    kill -9 $PID
    sleep 1
fi

# Удаляем файл с PID
rm -f ".pid"
echo "Микросервис остановлен"