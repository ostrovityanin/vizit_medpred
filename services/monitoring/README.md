# Сервис Мониторинга

Сервис для мониторинга работоспособности всех микросервисов и отправки отчетов в Telegram. Отслеживает состояние системы, собирает логи и предупреждает о проблемах.

## Основные функции

1. **Мониторинг микросервисов**
   - Регулярная проверка доступности всех микросервисов
   - Измерение времени отклика
   - Отслеживание статусов ответов

2. **Системный мониторинг**
   - Отслеживание использования памяти
   - Мониторинг нагрузки на CPU
   - Контроль времени непрерывной работы

3. **Работа с логами**
   - Сбор логов со всех микросервисов
   - Анализ логов на наличие ошибок
   - Сохранение истории статусов сервисов

4. **Уведомления в Telegram**
   - Ежечасные отчеты о состоянии системы
   - Мгновенные уведомления о сбоях в работе
   - Детальные отчеты о состоянии микросервисов

## Запуск сервиса

### Настройка переменных окружения

Перед запуском необходимо настроить переменные окружения. Скопируйте файл `.env.example` в `.env` и укажите необходимые значения:

```bash
cp .env.example .env
```

Обязательные переменные для настройки:
- `TELEGRAM_BOT_TOKEN` - токен Telegram бота для отправки уведомлений
- `TELEGRAM_CHAT_ID` - идентификатор чата Telegram для отправки уведомлений

### Запуск в режиме разработки

```bash
npm run dev
```

### Запуск в продакшн-режиме

```bash
npm start
```

## API Endpoints

| Endpoint | Метод | Описание |
|----------|-------|----------|
| `/health` | GET | Проверка работоспособности самого сервиса мониторинга |
| `/api/status` | GET | Получение статуса всех микросервисов и системы |
| `/api/logs` | GET | Получение результатов анализа логов |
| `/api/send-report` | POST | Принудительная отправка отчета в Telegram |

## Интеграция с Telegram

Сервис отправляет регулярные отчеты в указанную Telegram группу (https://t.me/+aSBUkdXGNS5mMzU6). Отчеты включают:

1. **Ежечасные статусы**
   - Статус всех микросервисов
   - Использование системных ресурсов
   - Общее состояние системы

2. **Уведомления о проблемах**
   - Мгновенные сообщения при обнаружении недоступности сервисов
   - Детали об ошибках и возможных причинах
   - Информация о времени возникновения проблемы

## Логирование

Сервис сохраняет логи в директории `/logs`:
- `combined.log` - все логи
- `error.log` - только ошибки
- `/status/*.log` - историю статусов сервисов с разбивкой по дням

## Docker

Для запуска сервиса в Docker:

```bash
docker build -t monitoring-service .
docker run -p 3006:3006 --env-file .env monitoring-service
```

## Интеграция с другими микросервисами

Сервис мониторинга проверяет доступность следующих сервисов:

1. Хранилище данных - `http://data-storage:3002`
2. Аудио процессор - `http://audio-processor:3003`
3. Документация - `http://documentation:3004`
4. API Core - `http://api-core:3001`
5. Telegram Mini App - `http://telegram-app:3000`
6. Админ-панель - `http://admin-panel:3005`