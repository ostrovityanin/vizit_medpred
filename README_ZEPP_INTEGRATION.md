# Интеграция с Zepp OS 3.0

## Обзор интеграции

Данный проект включает полную интеграцию с Zepp OS 3.0, позволяющую использовать умные часы Amazfit/Zepp для записи аудио и отправки его на сервер. Это расширяет возможности существующего решения Telegram Mini App, добавляя поддержку носимых устройств.

## Компоненты решения

### 1. Приложение для Zepp OS

Мы разработали специальное приложение для Zepp OS, которое можно установить на совместимые умные часы. Приложение включает:

- Интерфейс для записи аудио с микрофона часов
- Систему фрагментированной записи для обхода ограничений памяти устройства
- Управление сессиями записи через уникальные идентификаторы
- Отправку аудиофрагментов на сервер с поддержкой повторных попыток
- Просмотр истории записей

### 2. Серверная часть

Серверная часть обеспечивает обработку запросов от приложения Zepp OS:

- API-эндпоинты для приема фрагментов аудио
- Хранение и управление фрагментами
- Объединение фрагментов в единую запись
- Обработка и транскрибирование аудио
- Доступ к записям через веб-интерфейс

## Технические детали

### Формат аудио

Приложение на Zepp OS записывает аудио в формате WebM с кодеком Opus, который затем серверная часть преобразует в формат WAV для обработки через OpenAI API.

### Процесс записи и отправки

1. Пользователь начинает запись на часах
2. Аудио записывается сегментами по 30 секунд
3. Каждый сегмент немедленно отправляется на сервер (для экономии памяти устройства)
4. При завершении записи на сервер отправляется запрос на объединение фрагментов
5. Сервер объединяет фрагменты, конвертирует аудио и выполняет транскрипцию

### Обработка ошибок

- Реализована система повторных попыток для отправки фрагментов при проблемах с сетью
- Сохранение состояния сессии для восстановления после прерываний
- Мониторинг состояния каждого фрагмента и общего статуса записи

## API эндпоинты для Zepp OS

### Отправка фрагмента аудио
```
POST /api/zepp/recording-fragments
Content-Type: multipart/form-data
Body:
  - fragmentAudio: <binary audio data>
  - sessionId: <string>
  - index: <number>
```

### Финализация записи
```
POST /api/zepp/finalize-recording
Content-Type: application/json
Body: {
  "sessionId": <string>,
  "duration": <number>,
  "fragmentCount": <number>
}
```

## Установка и тестирование

Детальные инструкции по установке и тестированию приложения для Zepp OS доступны в файлах:
- [Инструкция по установке](./zepp_deploy_instructions.md)
- [Руководство по тестированию в симуляторе](./zepp_simulator_guide.md)

## Загрузка приложения

Скомпилированный пакет приложения для Zepp OS доступен по адресу:
```
http://[ваш_сервер]/zepp_app_bundle.zab
```

## Совместимость

Интеграция протестирована и работает на следующих устройствах:
- Amazfit GTR 3
- Amazfit GTR 3 Pro
- Amazfit GTS 3
- Amazfit T-Rex 2
- Другие устройства с Zepp OS 3.0 и выше

## Ограничения

- Максимальная длительность записи ограничена 15 минутами (программное ограничение)
- Качество записи зависит от микрофона конкретного устройства
- Требуется подключение к интернету для отправки фрагментов

## Дальнейшее развитие

Планируется добавить следующие функции:
- Оптимизация энергопотребления при длительных записях
- Локальное кэширование фрагментов при отсутствии сети
- Поддержка шифрования для аудиозаписей
- Интеграция с другими носимыми устройствами