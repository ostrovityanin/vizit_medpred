# Руководство по тестированию интеграции с Zepp OS

Этот документ описывает, как тестировать интеграцию между сервером и приложением Zepp OS без установки пакета на реальное устройство.

## Тестирование с помощью скрипта эмуляции

В репозитории включен скрипт `test-zepp-integration.js`, который эмулирует отправку аудио-фрагментов с часов на сервер.

### Как работает скрипт

Скрипт выполняет следующие действия:
1. Создает уникальный идентификатор сессии
2. Отправляет несколько аудио-фрагментов на сервер через API
3. Отправляет запрос на финализацию записи
4. Проверяет успешность создания записи на сервере

### Как запустить тест

```bash
# Запуск с использованием Node.js
node test-zepp-integration.js

# Запуск с использованием тестового образца аудио
AUDIO_PATH=путь/к/тестовому/аудио.webm node test-zepp-integration.js
```

## Ручное тестирование API

Вы также можете протестировать API-эндпоинты напрямую, используя curl или любой HTTP-клиент.

### 1. Отправка фрагмента записи

```bash
curl -X POST http://localhost:5000/api/zepp/recording-fragments \
  -F "sessionId=test-session-123" \
  -F "index=0" \
  -F "fragmentAudio=@путь/к/аудиофайлу.webm" \
  -F "deviceInfo={\"model\":\"gtr3-pro\",\"firmware\":\"3.0.0\"}"
```

### 2. Финализация записи

```bash
curl -X POST http://localhost:5000/api/zepp/finalize-recording \
  -H "Content-Type: application/json" \
  -d '{
    "sessionId": "test-session-123",
    "fragmentCount": 1,
    "duration": 30,
    "deviceInfo": {
      "model": "gtr3-pro",
      "firmware": "3.0.0",
      "appVersion": "1.0.0"
    }
  }'
```

## Параметры запросов

### Фрагмент записи (`/api/zepp/recording-fragments`)

| Параметр | Тип | Описание |
|----------|-----|----------|
| sessionId | string | Уникальный идентификатор сессии записи |
| index | number | Индекс фрагмента (начиная с 0) |
| fragmentAudio | file | Аудиофайл в формате WebM |
| deviceInfo | string (JSON) | Информация об устройстве |

### Финализация записи (`/api/zepp/finalize-recording`)

| Параметр | Тип | Описание |
|----------|-----|----------|
| sessionId | string | Уникальный идентификатор сессии записи |
| fragmentCount | number | Количество отправленных фрагментов |
| duration | number | Общая продолжительность записи в секундах |
| deviceInfo | object | Информация об устройстве |

## Примечания

- Убедитесь, что сервер запущен перед выполнением тестов
- Аудиофайлы должны быть в формате WebM
- При тестировании рекомендуется использовать короткие аудио-фрагменты (5-10 секунд)
- Успешный ответ от сервера при финализации должен содержать поле `recordingId`

## Ожидаемые ответы от сервера

### Успешная отправка фрагмента
```json
{
  "success": true,
  "message": "Фрагмент #0 получен и сохранен",
  "fragmentId": 123
}
```

### Успешная финализация
```json
{
  "success": true,
  "message": "Запись успешно создана",
  "recordingId": 456,
  "recording": {
    "id": 456,
    "title": "Запись с Zepp OS",
    "duration": 30,
    "status": "processing"
  }
}
```