# Улучшенная диаризация аудио и транскрипция

## Реализованные улучшения

1. **Оптимизирована обработка сегментов аудио**
   - Уменьшен минимальный размер сегмента с 0.3с до 0.2с для более точного определения переходов
   - Уменьшена минимальная длительность тишины с 0.3с до 0.25с для лучшего определения пауз
   - Улучшено определение порога тишины (-35dB)

2. **Улучшена кластеризация говорящих**
   - Реализован алгоритм на основе чередования сегментов с паузами
   - Добавлена эвристика определения говорящих по паузам между репликами
   - Система успешно идентифицирует 2+ говорящих в диалоге

3. **Расширены возможности анализа аудио**
   - Добавлены методы обнаружения частотных характеристик
   - Реализованы алгоритмы анализа уровня громкости речи
   - Добавлены резервные методы на случай ошибок анализа

4. **Улучшена совместимость с разными моделями транскрипции**
   - Интегрирована поддержка всех 3 моделей в рамках одного API
   - Сравнительный анализ транскрипций разными моделями
   - Полные статистические данные о времени обработки

## Технические детали реализации

### Параметры обработки аудио
- **Порог тишины:** -35dB
- **Минимальная длительность тишины:** 0.25с
- **Минимальный размер сегмента:** 0.2с

### Алгоритм кластеризации
1. Сортируем сегменты речи по времени начала
2. Анализируем паузы между сегментами
3. Если паузы превышают 0.5с, применяем чередование говорящих
4. Распределяем сегменты между говорящими: 1, 2, 1, 2, ...

### Сравнение производительности моделей
На тестовом файле clear_dialog.mp3:
- **whisper-1:** ~0.83с на сегмент
- **gpt-4o-mini-transcribe:** ~1.66с на сегмент
- **gpt-4o-transcribe:** ~1.74с на сегмент

## Примеры использования

### Пример диаризации без транскрипции
```javascript
// Отправка запроса на API диаризации
const response = await axios.post('http://localhost:5000/api/diarize', formData, {
  headers: formData.getHeaders()
});

// Получение результата
const result = response.data;
console.log(`Найдено ${result.segments.length} сегментов речи от ${result.num_speakers} говорящих`);
```

### Пример сравнительной транскрипции
```javascript
// Отправка запроса на API сравнительной диаризации
const response = await axios.post('http://localhost:5000/api/diarize/compare', formData, {
  headers: formData.getHeaders()
});

// Получение результатов по разным моделям
const modelResults = response.data.model_results;
console.log(`Модель whisper-1: среднее время обработки ${modelResults['whisper-1'].avg_processing_time.toFixed(2)}с`);
```

## Рекомендации по применению

1. **Для коротких аудио** (до 1 минуты):
   - Используйте модель gpt-4o-transcribe для максимального качества транскрипции

2. **Для средних аудио** (1-5 минут):
   - Используйте whisper-1 для более быстрой обработки
   - Если важно качество русскоязычного текста, используйте gpt-4o-mini-transcribe

3. **Для аудио с несколькими говорящими**:
   - Всегда включайте параметр `withDiarization: true`
   - Рекомендуется устанавливать `silenceThreshold: '-35dB'` для лучшего определения пауз